language: python

python:
        - "2.7"
addons:
  postgresql: "9.3"

virtualenv:
      system_site_packages: true

before_install:
        - psql -c 'create database mydb;' -U postgres

install:
        - sudo apt-get install python-qt4
        - sudo apt-get install qgis
        - sudo apt-get install python-qgis
        - sudo apt-get install postgresql-9.3-postgis-2.1
        - sudo apt-get install vnc4server # to mock an X Server
        - pip install mock
        - pip install nose
        - pip install coverage
        - pip install coveralls
        - pip install psycopg2

before_script:
        - echo -e "p4ssw0rd\np4ssw0rd\n" | vncserver -geometry 1024x768 :99
        - export DISPLAY=:99.0
        - psql -U postgres  mydb -c "create extension postgis"
        - psql -U postgres -c "ALTER USER postgres WITH PASSWORD 'postgres'"; 

script:  sh run_tests.sh # this runs tests with coverage

after_success:
    coveralls
